(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{401:function(t,s,a){"use strict";a.r(s);var e=a(54),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"谈谈-babel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#谈谈-babel"}},[t._v("#")]),t._v(" 谈谈 Babel")]),t._v(" "),a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),a("p",[t._v("本文讲解 Babel，下一篇文章讲解 webpack，本来想一起记个笔记的，但是 babel 写下来感觉东西还是很多的，放一起的话过于长，不便食用")]),t._v(" "),a("p",[a("strong",[t._v("1.什么是 webpack？")])]),t._v(" "),a("p",[t._v("webpack 是一个现代 JavaScript 应用程序的静态模块打包器，当 webpack 处理应用程序时，会递归构建一个依赖关系图，其中包含应用程序需要的每个模块，然后将这些模块打包成一个或多个 "),a("code",[t._v("bundle")]),t._v("。")]),t._v(" "),a("p",[a("strong",[t._v("2.什么是 babel？")])]),t._v(" "),a("p",[t._v("Babel 是一个 JS 编译器，主要用于将 ECMAScript 2015+ 版本的代码转换为向后兼容的 JavaScript 语法，以便能够运行在当前和旧版本的浏览器或其他环境中。")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("webpack 和 babel 的关系")]),t._v(" "),a("p",[a("code",[t._v("Webpack")]),t._v("把所有文件（包括图片、css 等）都当成模块(module)，但是 webpack 只懂 js，所以"),a("code",[t._v("loaders")]),t._v("起到关键作用，"),a("code",[t._v("Babel")]),t._v("就是一种 loader 所以"),a("code",[t._v("Webpack")]),t._v("和"),a("code",[t._v("Babel")]),t._v("通常是配合使用的，")])]),t._v(" "),a("p",[a("strong",[t._v("3.我们为什么需要 webpack 和 babel？")])]),t._v(" "),a("p",[t._v("（1）浏览器目前不完全支持 ES6 及以上的语法，"),a("code",[t._v("babel")]),t._v(" 用各种方式将 ES6 的语法转为 ES5 之前的方法，以供浏览器识别。")]),t._v(" "),a("p",[t._v("（2）"),a("code",[t._v("webpack")]),t._v("可以递归形成依赖关系，整合代码，压缩代码量，减少项目体积，让网页加载更快。")]),t._v(" "),a("h2",{attrs:{id:"基础理论知识"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础理论知识"}},[t._v("#")]),t._v(" 基础理论知识")]),t._v(" "),a("h3",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),a("p",[t._v("没有 "),a("code",[t._v("核心库 @babel/core")]),t._v(" ，babel 就没有办法编译， "),a("code",[t._v("命令行工具 @babel/cli")]),t._v(" 则是 babel 提供的命令行工具，主要是提供 babel。(当然这只是最基础的需要安装的)")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("npm install --save-dev @babel/core @babel/cli\n")])])]),a("h3",{attrs:{id:"插件-plugins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#插件-plugins"}},[t._v("#")]),t._v(" 插件(Plugins)")]),t._v(" "),a("p",[t._v("直接输入命令 "),a("code",[t._v("npm run build")]),t._v(" 的时候我们会发现，编译出来的 es6 语法并不会被转换为 es6 以前的语法，因为 "),a("code",[t._v("Babel")]),t._v(" 虽然开箱即用，但是什么动作也不会做，如果想要 babel 做一些实际的工作，就需要为其添加插件("),a("code",[t._v("plugin")]),t._v(")。")]),t._v(" "),a("p",[t._v("babel 的插件有两种，一种是"),a("strong",[t._v("语法插件")]),t._v("，这类插件是在解析阶段辅助解析器（Babylon）工作；另一类插件是"),a("strong",[t._v("转译插件")]),t._v("，这类插件是在转换阶段参与进行代码的转译工作，这也是我们使用 babel 最常见也最本质的需求。")]),t._v(" "),a("p",[t._v("(关于 babel 的解析转化和生成，日后再做文章 本文不多赘述)")]),t._v(" "),a("p",[t._v("我们可以现在目录下面建一个文件叫 "),a("code",[t._v(".babelrc")]),t._v(" 用来写配置，比如我们在其中加入转化 es6 中箭头函数语法的插件：")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"plugins"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@babel/plugin-transform-arrow-functions"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("那么项目中的箭头函数都会被转换为普通函数形式，但是这样还是很繁琐，毕竟新的语法太多了，我们需要一个东西来简化配置，这便是"),a("strong",[t._v("预设")])]),t._v(" "),a("h3",{attrs:{id:"预设-presets"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#预设-presets"}},[t._v("#")]),t._v(" 预设(Presets)")]),t._v(" "),a("p",[t._v("通过使用或创建一个 "),a("code",[t._v("preset")]),t._v(" 即可轻松使用一组插件。")]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("官方有四种 preset：")]),t._v(" "),a("p",[t._v("@babel/preset-env")]),t._v(" "),a("p",[t._v("@babel/preset-flow")]),t._v(" "),a("p",[t._v("@babel/preset-react")]),t._v(" "),a("p",[t._v("@babel/preset-typescript")])]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"presets"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@babel/preset-env"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("这里需要说明的是 "),a("code",[t._v("@babel/preset-env")]),t._v(" 会根据你的目标环境生成插件列表来编译，官方推荐使用 "),a("code",[t._v(".browserslistrc")]),t._v(" 文件来指定目标环境（当然你也可以在 "),a("code",[t._v(".babelrc")]),t._v(" 中设置 "),a("code",[t._v("targets")]),t._v(" 或 "),a("code",[t._v("ignoreBrowserslistConfig")]),t._v("）\n如果你不是要兼容所有的浏览器和环境，推荐你指定目标环境，这样你的编译代码能够保持最小，比如:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("// 仅包含市场份额超过 0.25%并且为最后两个版本并且官方两年内还在维护的浏览器\n> 0.25%\nlast 2 versions\nnot dead\n")])])]),a("p",[a("a",{attrs:{href:"https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fbrowserslist%2Fbrowserslist",target:"_blank",rel:"noopener noreferrer"}},[t._v(".browserslistrc 官方文档"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("code",[t._v("@babel/preset-env")]),t._v("也提供注入 "),a("code",[t._v("polyfill")]),t._v(" 的方法，这个下文会说到。")]),t._v(" "),a("h3",{attrs:{id:"垫片-polyfill-两个方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#垫片-polyfill-两个方案"}},[t._v("#")]),t._v(" 垫片(Polyfill)(两个方案)")]),t._v(" "),a("p",[t._v("让我们在代码中写入这一段：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" isHas "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("includes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" p "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("编译结果为：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'use strict'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" isHas "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("includes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" p "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("很明显 includes 和 promise 并没有被转换，因为语法转换只是将高版本的语法转换成低版本的，但是新的 API(内置函数、实例方法)无法转换。这时，就需要使用 "),a("code",[t._v("polyfill")]),t._v(" 也就是 "),a("code",[t._v("垫片")]),t._v(" ，它的作用就是让新的内置函数、实例方法等在低版本浏览器中也可以使用。")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("垫片(Polyfill)这一块内容，我们不仅要知道如何配置，还要知道这些配置的区别和原因，我查资料的时候也是感觉非常的绕")]),t._v(" "),a("p",[a("strong",[t._v("先给出两种使用的方案")]),t._v("。")])]),t._v(" "),a("p",[a("strong",[t._v("业务项目中：")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("npm install --save core-js@3 regenerator-runtime\nnpm install --save-dev @babel/plugin-transform-runtime\nnpm install --save @babel/runtime\n")])])]),a("p",[a("code",[t._v("preset-env")]),t._v(" 既转换语法又转换 API")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"presets"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@babel/preset-env"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"targets"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 对于目标环境建议写在.browserslistrc中")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"chrome"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("58")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 可以自由配置")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"useBuiltIns"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"entry"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"corejs"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"proposals"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"plugins"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@babel/plugin-transform-runtime"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"corejs"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 入口文件中手动加入下面两行 (或者给webpack加入口)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'core-js/stable'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'regenerator-runtime/runtime'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),a("p",[a("strong",[t._v("Library 开发中：")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("npm install --save core-js@3 regenerator-runtime\nnpm install --save-dev @babel/plugin-transform-runtime\nnpm install --save @babel/runtime-corejs3\n")])])]),a("p",[a("code",[t._v("preset-env")]),t._v(" 只转换语法，"),a("code",[t._v("@babel/plugin-transform-runtime")]),t._v(" 负责转换 API")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"presets"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@babel/preset-env"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"plugins"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@babel/plugin-transform-runtime"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"corejs"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"proposals"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("strong",[t._v("下面着重描述一下两种配置方案的区别")])]),t._v(" "),a("h2",{attrs:{id:"preset-env-和-babel-plugin-transform-runtime"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#preset-env-和-babel-plugin-transform-runtime"}},[t._v("#")]),t._v(" preset-env 和 @babel/plugin-transform-runtime")]),t._v(" "),a("h3",{attrs:{id:"preset-env"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#preset-env"}},[t._v("#")]),t._v(" preset-env")]),t._v(" "),a("p",[t._v("preset-env 有三个常用关键词："),a("code",[t._v("targets")]),t._v("、"),a("code",[t._v("useBuiltIns")]),t._v("、"),a("code",[t._v("corejs")])]),t._v(" "),a("h4",{attrs:{id:"target"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#target"}},[t._v("#")]),t._v(" "),a("strong",[t._v("target")])]),t._v(" "),a("p",[t._v("这个字段用来指定目标"),a("strong",[t._v("运行环境")]),t._v("，可以填写 "),a("code",[t._v("browserslist")]),t._v(" 的"),a("strong",[t._v("查询字符串")]),t._v("或者"),a("strong",[t._v("描述浏览器版本组成的对象")]),t._v("，官方推荐使用 "),a("code",[t._v(".browserslistrc")]),t._v(" 文件去指明编译的 target，这个配置文件还可以和 autoprefixer、stylelint 等工具一起共享配置。\n所以某种程度上不推荐在"),a("code",[t._v(".babelrc")]),t._v(" 的 preset-env 配置中直接使用 targets 进行配置。")]),t._v(" "),a("blockquote",[a("p",[t._v("如果要在 "),a("code",[t._v(".babelrc")]),t._v(" 上配置 targets 的话，preset-env 中 "),a("code",[t._v("ignoreBrowserslistConfig")]),t._v(" 设置为 true 则忽略"),a("code",[t._v(".browserslistrc")]),t._v(" 的配置项。\n例：")])]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"targets"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"> 0.25%, not dead"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ignoreBrowserslistConfig"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ignoreBrowserslistConfig默认值是false")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("strong",[t._v("OR")])]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"targets"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"chrome"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"58"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ie"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"11"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ignoreBrowserslistConfig"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h4",{attrs:{id:"usebuiltins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#usebuiltins"}},[t._v("#")]),t._v(" "),a("strong",[t._v("useBuiltIns")])]),t._v(" "),a("p",[t._v("这个字段是用来指定 "),a("code",[t._v("polyfill")]),t._v(" 方案的,其默认值是 "),a("code",[t._v("false")]),t._v(" ，这种情况下，"),a("code",[t._v("preset-env")]),t._v(" 不执行 API 的转换（也就是不做垫片 Polyfill 的功能），只执行语法的转换。")]),t._v(" "),a("p",[t._v("如果我们需要使用 "),a("code",[t._v("preset-env")]),t._v(" 的 "),a("code",[t._v("polyfill")]),t._v(" 功能,"),a("code",[t._v("useBuiltIns")]),t._v("提供了两种值：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("entry")])]),t._v(" "),a("li",[a("strong",[t._v("usage")])])]),t._v(" "),a("p",[a("code",[t._v("entry")]),t._v(" 指的是将会根据浏览器目标环境(targets)的配置，引入"),a("strong",[t._v("全部")]),t._v("浏览器暂未支持的 polyfill 模块，无论在项目中是否使用到。")]),t._v(" "),a("p",[t._v("先安装依赖")]),t._v(" "),a("p",[t._v("**注意：V7.4.0 版本开始，@babel/polyfill 已经被废弃，需单独安装 "),a("code",[t._v("core-js")]),t._v(" 和 "),a("code",[t._v("regenerator-runtime")]),t._v(" **")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("npm install --save core-js@3 regenerator-runtime\n")])])]),a("p",[t._v("然后在入口处引入（或者在 webpack 配置文件中新增这两个包作为额外的入口）:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("import 'core-js/stable'\nimport 'regenerator-runtime/runtime'```\n")])])]),a("p",[a("code",[t._v("usage")]),t._v(" 会动态地根据我们地代码注入 polyfill，不会全量注入，可以有效减小打包体积，并且我们也不需要在入口处引入 polyfill")]),t._v(" "),a("ul",[a("li",[t._v("既然 "),a("code",[t._v("usage")]),t._v(" 比 "),a("code",[t._v("entry")]),t._v(" 只能这么多，我们为什么还要使用 "),a("code",[t._v("entry")]),t._v(" 呢?")])]),t._v(" "),a("p",[t._v("因为使用 "),a("code",[t._v("entry")]),t._v(" 可以有效避免项目中引入的第三方库 "),a("code",[t._v("polyfill")]),t._v(" 处理不当，导致异常的问题。但如果追求项目体积的大小，想要使用"),a("code",[t._v("usage")]),t._v(" 的话，项目中使用社区广泛使用的流行库能 "),a("code",[t._v("降低第三方库 polyfill 处理不当")]),t._v(" 的问题")]),t._v(" "),a("h4",{attrs:{id:"core-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#core-js"}},[t._v("#")]),t._v(" "),a("strong",[t._v("core-js")])]),t._v(" "),a("p",[t._v("首先 core-js 是完全模块化的 javascript 标准库，相当于 js 标准库的 polyfill，现在的 core-js3 支持最新的 es 标准")]),t._v(" "),a("blockquote",[a("p",[t._v("core-js v2 已经不再维护，推荐使用 v3 版本")])]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"corejs"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2 和 3 版本都需要手动安装库：npm i -s core-js@3")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"proposals"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 默认值为false，开启的话就可以使用提案阶段的语法")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"babel-plugin-transform-runtime"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#babel-plugin-transform-runtime"}},[t._v("#")]),t._v(" @babel/plugin-transform-runtime")]),t._v(" "),a("p",[t._v("首先安装依赖")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("npm install --save core-js@3 regenerator-runtime\nnpm install --save-dev @babel/plugin-transform-runtime\nnpm install --save @babel/runtime-corejs3\n")])])]),a("p",[a("code",[t._v("Plugin-transform-runtime")]),t._v(" 主要有三个功能：")]),t._v(" "),a("ul",[a("li",[t._v("当开发者使用异步或生成器的时候，自动引入@babel/runtime/regenerator，开发者不必在入口文件做额外引入")]),t._v(" "),a("li",[t._v("提供沙盒环境，避免全局环境的污染")]),t._v(" "),a("li",[t._v("移除 babel 内联的 helpers，统一使用@babel/runtime/helpers 代替，减小打包体积\n"),a("blockquote",[a("p",[t._v("使用此方案时，不需要在入口文件处手动引入 core-js 和 regenerator-runtime (也可以试试不执行 npm 的第一行命令，这种依赖的依赖，像套娃一样的，有时候会变，就是有时候需要你手动安装，有时候不要，毕竟我也不知道你们啥时候看的这个文章)")])])])]),t._v(" "),a("p",[t._v("三个功能中的第二点是很重要的一点，实际上，"),a("code",[t._v("preset-env")]),t._v(" 的 "),a("code",[t._v("polyfill")]),t._v("会"),a("strong",[t._v("污染")]),t._v("全局环境，作为项目开发无可厚非，但是如果我们在开发提供给其他开发者使用的 library，我想我们不应该污染全局，并且应该提供更好的打包体积和效率，所以这一点其实是作为了我区分两种方案的关键点。")]),t._v(" "),a("blockquote",[a("p",[t._v("为了添加这些那些新的 API，"),a("code",[t._v("preset-env")]),t._v(" 的 "),a("code",[t._v("polyfill")]),t._v(" 将添加到全局范围和类似 String 这样的内置原型中，所以造成了全局污染")])]),t._v(" "),a("p",[a("strong",[t._v("减少体积：")])]),t._v(" "),a("p",[t._v("解释一下第三点他是如何减少项目体积的，比如有这样一段代码：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" a\n")])])]),a("p",[t._v("编译后=>")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'use strict'")]),t._v("\n\nObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineProperty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'__esModule'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  value"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("default "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" _a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_interopRequireDefault")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_interopRequireDefault")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("obj")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" obj "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("__esModule "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" obj "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" obj "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" _default "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("default\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("default "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _default\n")])])]),a("p",[t._v("代码中多了一段"),a("code",[t._v("_interopRequireDefault")]),t._v("的函数,很明显它可以变成一个独立的模块，如果不配置"),a("code",[t._v("Plugin-transform-runtime")]),t._v(",那么每个用了"),a("code",[t._v("import")]),t._v("的文件中都会有一段"),a("code",[t._v("_interopRequireDefault")]),t._v("的代码，这就增加了很多没有意义的代码和体积。如果使用了"),a("code",[t._v("Plugin-transform-runtime")]),t._v(" ，那么用到 "),a("code",[t._v("import")]),t._v(" 的文件种，都会统一从"),a("code",[t._v("@babel/runtime/helpers/interopRequireDefault")]),t._v("中引入")]),t._v(" "),a("p",[t._v("使用 "),a("code",[t._v("Plugin-transform-runtime")]),t._v(" 编译后是这样的=>")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'use strict'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" _interopRequireDefault "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@babel/runtime/helpers/interopRequireDefault'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineProperty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'__esModule'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  value"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("default "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" _a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_interopRequireDefault")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" _default "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("default\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("default "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _default\n")])])]),a("p",[a("strong",[t._v("避免污染：")])]),t._v(" "),a("p",[a("code",[t._v("@babel/plugin-transform-runtime")]),t._v("不仅能减少体积，还能避免全局污染，这就需要开启 core-js 了，具体配置如下：")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"plugins"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@babel/plugin-transform-runtime"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"corejs"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"proposals"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("@babel/plugin-transform-runtime 开启 corejs 并且 @babel/preset-env 也开启 useBuiltIns 会咋样。结论是：被使用到的高级 API polyfill 将会采用 runtime 的不污染全局方案（注意：@babel/preset-env targets 设置将会失效），而不被使用到的将会采用污染全局的。")]),t._v(" "),a("p",[a("strong",[t._v("重要的事情说三遍")]),t._v(" "),a("strong",[t._v("@babel/runtime 要做为项目的 dependencies")]),t._v(" "),a("strong",[t._v("@babel/runtime 要做为项目的 dependencies")]),t._v(" "),a("strong",[t._v("@babel/runtime 要做为项目的 dependencies")])])]),t._v(" "),a("p",[a("strong",[t._v("为什么 @babel/preset-env 不能使用不污染全局的 polyfill（不污染全局的 polyfill 必须由 @babel/plugin-transform-runtime 引入）")])]),t._v(" "),a("p",[a("strong",[t._v("为什么要使用不污染全局的 polyfill 就必须要使用 @babel/plugin-transform-runtime，而与此同时我必须妥协掉 preset-env targets 带来的体积优势（由于是不污染全局的前提，我们默认是由 runtime 引入 polyfill ）")])]),t._v(" "),a("p",[t._v("怎么解决呢？")]),t._v(" "),a("p",[t._v("在现有的 babel 正式体系下还没好办法来解决这个问题，当然 babel 也意识到了这个问题，于是有了 "),a("code",[t._v("babel-polyfills")]),t._v("。")]),t._v(" "),a("p",[a("strong",[t._v("注意是 babel-polyfills 不是 @babel/polyfills")])]),t._v(" "),a("p",[a("code",[t._v("babel-polyfills")]),t._v("还在试验性的阶段，并不推荐大家在当前在生产中引入，保持关注即可。")]),t._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("p",[t._v("babel 是 webpack 必不可缺的一部分，是十分重要的一部分，它的配置和原理还是需要深入了解的，日后有时间，整理一波解析--转换--生成。\n本文参考：\n"),a("a",{attrs:{href:"https://www.babeljs.cn/docs/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Babel 官方文档"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://juejin.cn/post/6844904008679686152#heading-1",target:"_blank",rel:"noopener noreferrer"}},[t._v("不容错过的 Babel7 知识"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://juejin.cn/post/6984020141746946084#heading-4",target:"_blank",rel:"noopener noreferrer"}},[t._v("Babel 7: @babel/preset-env & plugin-transform-runtime 小知识"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/361874935",target:"_blank",rel:"noopener noreferrer"}},[t._v("吃一堑长一智系列: 99% 开发者没弄明白的 babel 知识"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=n.exports}}]);